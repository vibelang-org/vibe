// Examples of JavaScript interop patterns for Vibe
// These would work AFTER implementing member expressions

// ==============================================================================
// Pattern 1: String Methods (JS String API)
// ==============================================================================

let text = "hello world"
let upper = text.toUpperCase()           // "HELLO WORLD"
let lower = text.toLowerCase()           // "hello world"
let words = text.split(" ")              // ["hello", "world"]
let trimmed = "  spaces  ".trim()        // "spaces"
let replaced = text.replace("world", "vibe")  // "hello vibe"
let hasHello = text.includes("hello")    // true
let startsH = text.startsWith("h")       // true
let sub = text.substring(0, 5)           // "hello"

// ==============================================================================
// Pattern 2: Array Methods (JS Array API)
// ==============================================================================

let numbers = [1, 2, 3, 4, 5]

// Map: transform each element
let doubled = numbers.map((x) => x * 2)           // [2, 4, 6, 8, 10]

// Filter: select elements
let evens = numbers.filter((x) => x % 2 == 0)     // [2, 4]

// Reduce: accumulate to single value
let sum = numbers.reduce((acc, x) => acc + x, 0)  // 15

// Other useful methods
let first = numbers[0]                             // 1
let last = numbers[numbers.length - 1]             // 5
let sliced = numbers.slice(1, 3)                   // [2, 3]
let joined = numbers.join(", ")                    // "1, 2, 3, 4, 5"
let includes3 = numbers.includes(3)                // true

// Chaining methods
let result = numbers
  .filter((x) => x > 2)
  .map((x) => x * 2)
  .join("-")  // "6-8-10"

// ==============================================================================
// Pattern 3: Object Methods (JS Object API)
// ==============================================================================

let user = {
  name: "Alice",
  age: 30,
  email: "alice@example.com"
}

let keys = Object.keys(user)              // ["name", "age", "email"]
let values = Object.values(user)          // ["Alice", 30, "alice@example.com"]
let entries = Object.entries(user)        // [["name", "Alice"], ["age", 30], ...]

// Access properties
let userName = user.name                  // "Alice"
let userAge = user["age"]                 // 30 (computed access)

// ==============================================================================
// Pattern 4: Global JavaScript Objects
// ==============================================================================

// JSON
let jsonString = '{"name": "Bob", "score": 95}'
let parsed = JSON.parse(jsonString)
let name = parsed.name                    // "Bob"
let backToJson = JSON.stringify(parsed)

// Math
let randomNum = Math.random()             // 0.0 to 1.0
let rounded = Math.round(3.7)             // 4
let floored = Math.floor(3.7)             // 3
let ceiled = Math.ceil(3.2)               // 4
let maxNum = Math.max(1, 5, 3)            // 5
let minNum = Math.min(1, 5, 3)            // 1
let power = Math.pow(2, 3)                // 8
let pi = Math.PI                          // 3.14159...

// Date
let now = Date.now()                      // timestamp
let date = new Date()
let year = date.getFullYear()
let month = date.getMonth()

// Console
console.log("Debug:", user)
console.error("Error occurred")
console.warn("Warning message")

// ==============================================================================
// Pattern 5: Real-World AI + JS Example
// ==============================================================================

model m = { name: "gpt-4", apiKey: "test", url: "http://test" }

// Process data with JS, enhance with AI
let rawData = '{"users": ["alice", "bob", "charlie"]}'
let data = JSON.parse(rawData)
let users = data.users

// Transform with JS
let upperUsers = users.map((u) => u.toUpperCase())
let userList = upperUsers.join(", ")

// Enhance with AI
let greeting = do "Generate a friendly greeting for these users: {userList}" m default

// Format output
let final = {
  users: users,
  count: users.length,
  greeting: greeting,
  timestamp: Date.now()
}

let output = JSON.stringify(final)
console.log(output)

// ==============================================================================
// Pattern 6: Chaining JS Methods with AI
// ==============================================================================

let comments = [
  "This is great!",
  "Not sure about this...",
  "Amazing work!",
  "Could be better"
]

// JS: filter and transform
let longComments = comments
  .filter((c) => c.length > 15)
  .map((c) => c.toLowerCase())

// AI: analyze sentiment
let sentiment = do "Analyze sentiment of these comments: {longComments}" m default

// JS: format results
let report = {
  total: comments.length,
  analyzed: longComments.length,
  sentiment: sentiment
}

console.log(JSON.stringify(report, null, 2))
